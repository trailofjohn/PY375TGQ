# Deep Space Navigation: A Technical Manual
**Theory and Implementation of the Spacetime Estimator**

---

## Part 1: Fundamentals of Orbit Determination

### 1.1 The Problem Statement
Propagating a spacecraft's trajectory is an Initial Value Problem (IVP). Given state $X_0$ at time $t_0$, where is it at $t_k$?
$$ \dot{X} = f(X, t) $$
In deep space, this is governed primarily by the N-Body Problem. For our simulation, we simplify to the restricted 2-body problem (Sun-Probe).

### 1.2 Newtonian Dynamics
The primary acceleration is solar gravity:
$$ \ddot{\vec{r}} = -\frac{\mu}{|\vec{r}|^3} \vec{r} $$
where $\mu \approx 1.327 \times 10^{20} m^3/s^2$.

### 1.3 The Kalman Filter
We cannot know $X$ perfectly. We have a belief distribution $P$ (Covariance).
*   **Prediction**: We push the Gaussian distribution through the physics equations. $P$ grows because little errors accumulate.
*   **Update**: We crop the Gaussian using measurements ($z$).
The **Extended Kalman Filter (EKF)** is used because our physics ($1/r^2$) and measurements ($\sqrt{x^2+y^2}$) are non-linear. We linearize them using Jacobian matrices ($F$ and $H$).

---

## Part 2: Relativistic & Timing Physics

### 2.1 Coordinate Time vs. Proper Time
*   **Coordinate Time ($t$)**: The time measured by a clock at infinity (or effectively, on Earth for our purposes).
*   **Proper Time ($\tau$)**: The time measured by the clock *on the probe*.

According to General Relativity, these tick at different rates:
$$ \frac{d\tau}{dt} \approx 1 - \frac{U}{c^2} - \frac{v^2}{2c^2} $$
*   **Gravitational Redshift ($U/c^2$)**: Clocks run slower deeper in a gravity well (closer to Sun).
*   **Time Dilation ($v^2/2c^2$)**: Clocks run slower when moving fast.

In **Scenario C (Solar Grazer)**, the probe moves at $>100$ km/s near the Sun. Both terms contribute massive errors if ignored.

### 2.2 The Shapiro Delay
Light does not travel in a straight line in curved spacetime. It follows a null geodesic. Passing near a massive body (Sun) adds a delay $\Delta t$:
$$ \Delta t = \frac{4GM}{c^3} \ln\left( \frac{r_e + r_p + r_{ep}}{r_e + r_p - r_{ep}} \right) $$
This effect measures in *meters* of range error (approx 30km near Solar conjunction).

---

## Part 3: Architecture Breakdown

### 3.1 Version 0 (Baseline)
**Goal**: Establish the pipeline.
*   **State**: 9 Elements (Position, Velocity, Clock Bias Poly).
*   **Observable**: Range only.
*   **Deficiencies**:
    *   No Doppler (slow velocity convergence).
    *   Clock Drift modeled as random walk (non-physical).
    *   Instantaneous Light-Time (non-causal).

### 3.2 Version 1 (Flight-Ready)
**Goal**: High-fidelity relativistic navigation.
*   **State**: 10 Elements (Added Proper Time $\tau$).
*   **Observables**: Range + Doppler.
*   **Upgrades**:
    *   **Light-Time Iteration**: We solve $t_{emit} = t_{recv} - \text{LightTime}(t_{emit}, t_{recv})$. Crucial for Jovian distances where light time is $>40$ mins.
    *   **Doppler Fusion**: Range-Rate measurements constrain the velocity vector instantly, collapsing the covariance ellipsoid perpendicular to the Line of Sight.

---

## Part 4: Mathematical Derivations

### 4.1 The Jacobian of Gravity
To propagate uncertainty, we need $\frac{\partial \mathbf{a}}{\partial \mathbf{r}}$ (The Gravity Gradient Tensor):
$$ G = \frac{\mu}{r^5} \left( 3 \mathbf{r} \mathbf{r}^T - r^2 \mathbf{I} \right) $$
This symmetric 3x3 matrix describes tidal forcesâ€”how gravity pulls harder on the nose of the ship than the tail.

### 4.2 The Doppler Measurement Equation
Geometric Range Rate $\dot{\rho}$:
$$ \dot{\rho} = \hat{u} \cdot \vec{v}_{rel} $$
where $\hat{u}$ is the unit vector pointing from Earth to Probe.
Gradient with respect to velocity is straightforward ($\hat{u}$).
Gradient with respect to position is complex because changing position changes the *angle*, which changes which existing velocity component projects onto the line of sight.

---

## Part 5: Operational Scenarios

### 5.1 Scenario A: Martian Standard
*   **Dynamics**: Hohmann Transfer.
*   **Challenge**: Baseline validation. Low relativistic effects.

### 5.2 Scenario B: Jovian Deep-Dive
*   **Dynamics**: High-energy parabolic trajectory.
*   **Challenge**: **Observation Geometry**. At 300 days, the Sun blocks the line of sight (Solar Conjunction). The Shapiro delay spikes. Light time becomes significant.

### 5.3 Scenario C: Solar Grazer
*   **Dynamics**: Highly elliptical, $r_p = 0.05$ AU.
*   **Challenge**: **Relativistic Stress**. Velocity approaches $0.05c$. General Relativistic terms dominate the error budget. If the Shapiro model is wrong, the filter diverges.

---
*Generated by Antigravity Agent for Spacetime Estimator Project*
